<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.paper.persistance.mapper.UserMapper">
	<select id="getUserList" resultType="User_infoDTO">
		SELECT 
			USER_NO,
		    EMAIL,
		    PASSWORD,
		    USER_NAME,
		    BELONG,
		    AUTH,
		    PHONE,
		    REG_DT,
		    REG_USER_NO,
		    CHG_DT,
		    CHG_USER_NO
		FROM
			USER_INFO;
	</select>
	<insert id="insertUser" parameterType="User_infoDTO">
		INSERT INTO USER_INFO (
			EMAIL,
			USER_NAME,
			PASSWORD,
			BELONG,
			PHONE,
			AUTH,
			REG_USER_NO,
			REG_DT
			)VALUES(
			#{email},
			#{user_name},
			PASSWORD(#{password}),
			#{belong},
			#{phone},
			'U',
			LAST_INSERT_ID(),
			now()
			)
	</insert>
	<update id="updateRegUser" parameterType="User_infoDTO">
		UPDATE USER_INFO SET REG_USER_NO =
		(SELECT * FROM (SELECT USER_NO FROM USER_INFO WHERE EMAIL=#{email}) AS s) WHERE EMAIL = #{email}
	</update>
	
	<select id="getLoginInfo" parameterType="User_infoDTO" resultType="User_infoDTO">
		SELECT USER_NO, USER_NAME, AUTH, EMAIL FROM USER_INFO WHERE EMAIL=#{email} AND PASSWORD = PASSWORD(#{password})
	</select>
	
	<select id="overLapEmail" parameterType="User_infoDTO" resultType="int">
		SELECT COUNT(*) FROM USER_INFO WHERE EMAIL = #{email}
	</select>	
</mapper>